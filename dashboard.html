<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StarTrack U - 专注</title>
  <link rel="stylesheet" href="css/main.css">
  <!-- 引入主题管理脚本 -->
  <script src="js/theme.js"></script>
  <!-- 引入核心数据库 -->
  <script src="js/database.js"></script>
  <link rel="stylesheet" href="css/dashboard.css">
</head>
<body>

<main>
  <aside class="sidebar">
    <div class="card" style="text-align: center; padding: 20px;">
        <div id="clock" style="font-size: 32px; font-weight: 900; color: var(--accent); letter-spacing: 1px; line-height: 1;">00:00:00</div>
        <div id="dateDisplay" style="font-size: 14px; color: var(--muted); margin-top: 8px; font-weight: 600;"></div>
    </div>
    
    <div>
      <div class="section-title">专注统计</div>
      <div class="stats-mini-grid">
        <div class="stat-mini-card">
          <div class="stat-mini-label">连续打卡</div>
          <div class="stat-mini-value" id="streakVal">--</div>
        </div>
        <div class="stat-mini-card">
          <div class="stat-mini-label">今日</div>
          <div class="stat-mini-value" id="todayVal">--</div>
        </div>
      </div>
    </div>

    <!-- Group Goal Sync -->
    <div>
      <div class="section-title">团队目标</div>
      <div class="card" style="padding: 12px; background: rgba(80, 167, 255, 0.1); border: 1px solid var(--accent-2); color: var(--accent-2); font-weight: bold; font-size: 13px; text-align: center;">
        <span id="groupGoalDisplay">加载中...</span>
      </div>
    </div>

    <!-- New Feature: Daily Check-in & Quote -->
    <div>
      <div class="section-title">每日签到</div>
      <div class="card" style="padding: 15px; background: var(--panel-2); border: 1px solid var(--border); text-align: center;">
        <div id="checkInBox">
            <button class="btn btn-primary" onclick="doCheckIn()" style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
              点击签到
            </button>
        </div>
        <div id="dailyQuoteBox" style="display: none; margin-top: 10px; animation: fadeIn 0.5s;">
            <div style="color: var(--accent); font-weight: bold; margin-bottom: 8px; font-size: 14px;">✅ 签到完成</div>
            <p id="dailyQuote" style="font-size: 13px; color: var(--muted); font-style: italic; margin: 0; line-height: 1.5;"></p>
        </div>
      </div>
    </div>

    <div>
      <div class="section-title">每日进度</div>
      <div class="card progress-box">
        <div class="ring-container" id="ring"><div class="ring-text" id="progPercent">0%</div></div>
        <div style="font-size: 13px; color: var(--muted); line-height: 1.6;">完成任务以推进轨道进度。</div>
      </div>
    </div>

    <div>
      <div class="section-title">任务列表</div>
      <div id="taskList">
        <div class="task-item" onclick="toggleTask(this)">
          <div style="display:flex; flex-direction:column; gap:4px;">
            <span class="task-name">LeetCode 每日挑战</span>
            <span class="task-timer" style="font-size:11px; color:var(--muted); font-family:monospace;">00:00:00</span>
          </div>
          <div class="dot"></div>
        </div>
        <div class="task-item" onclick="toggleTask(this)">
          <div style="display:flex; flex-direction:column; gap:4px;">
            <span class="task-name">阅读技术文档 (10页)</span>
            <span class="task-timer" style="font-size:11px; color:var(--muted); font-family:monospace;">00:00:00</span>
          </div>
          <div class="dot"></div>
        </div>
      </div>
      <div class="quick-add">
        <input type="text" id="taskInput" class="input-dark" placeholder="新任务 (回车添加)..." onkeypress="if(event.key === 'Enter') addTask()">
        <button class="btn btn-primary" style="padding: 10px 18px;" onclick="addTask()">+</button>
      </div>
    </div>



    <div style="margin-top: auto; padding-top: 20px; border-top: 1px solid var(--border);">
      <button onclick="window.top.location.href='index.html'" class="btn btn-outline" style="width: 100%; font-size: 12px; padding: 10px;">退出登录</button>
    </div>
  </aside>

  <section class="content">
    <div class="card" style="border-left: 5px solid var(--accent);">
      <div class="section-title">今日专注</div>
      <div style="display: flex; align-items: center; gap: 15px;">
        <input type="text" id="dailyFocusInput" placeholder="今天的主要目标是什么？" style="background: transparent; border: none; color: var(--text); font-size: 22px; font-weight: 900; width: 100%; outline: none;">
        <div style="color: var(--accent); font-size: 12px; font-weight: 800; white-space: nowrap;">[ 一件大事 ]</div>
      </div>
    </div>

    <div class="card" style="flex: 1; display: flex; flex-direction: column; justify-content: center; position: relative; overflow: hidden;">
      <div class="section-title" style="text-align: center;" id="timerStatus">深度工作计时器</div>
      
      <div style="margin: 0 auto 15px; width: 80%; max-width: 280px;">
        <select id="focusTaskSelect" onchange="onTaskSelectChange()" style="width: 100%; background: var(--panel-2); color: var(--text); border: 1px solid var(--border); padding: 10px; border-radius: 8px; outline: none; font-size: 13px;">
            <option value="">-- 选择要追踪的任务 --</option>
        </select>
      </div>

      <div class="preset-group">
        <div class="btn-tag" onclick="setPreset(25)">25 分钟</div>
        <div class="btn-tag" onclick="setPreset(50)">50 分钟</div>
        <div class="btn-tag" onclick="setPreset(0)">自定义</div>
      </div>

      <div class="timer-display" id="timer">00:00:00</div>
      
      <div class="controls">
        <button class="btn btn-primary" id="startBtn" onclick="startTimer()">开始专注</button>
        <button class="btn btn-outline" onclick="stopTimer()">暂停</button>
        <button class="btn btn-outline" onclick="resetTimer()">重置</button>
        <button class="btn btn-primary" id="completeTaskBtn" onclick="completeCurrentTask()" style="display: none; background: var(--accent-2); color: black; border: none; font-weight: bold;">完成任务</button>
      </div>
      <div style="position: absolute; bottom: -50px; left: 50%; transform: translateX(-50%); width: 200px; height: 100px; background: var(--accent-2); filter: blur(80px); opacity: 0.1; pointer-events: none;"></div>
    </div>

    <!-- Footer -->
    <footer style="margin-top: auto; padding-top: 20px; border-top: 1px solid var(--border); color: var(--muted); font-size: 12px; text-align: center;">
      <div>&copy; 2025 StarTrack U. 版权所有。</div>
    </footer>
  </section>
</main>

<div id="celebrationOverlay" class="celebration-overlay" onclick="this.style.display='none'">
  <div class="celebration-card" onclick="event.stopPropagation()">
    <div class="celebration-title">🎉 恭喜完成！</div>
    <div class="celebration-text" id="celebrationMsg"></div>
    <button class="btn btn-primary" onclick="document.getElementById('celebrationOverlay').style.display='none'">太棒了</button>
  </div>
</div>

<script src="js/dashboard.js"></script>
</body>
</html>